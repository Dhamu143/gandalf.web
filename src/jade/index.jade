doctype html
html(ng-app="app")
  head(lang='en')
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no')
    title Gandalf. We protect you from yo urselves
    link(rel='stylesheet', href='css/app.css')

  body.container.app
    .row

      .col.col-md-12(ng-controller="MainController")
        .decision-table.ng-cloak(ng-if="table")
          table.table
            thead: tr
              th #
              th(ng-repeat="condition in table.fields") {{condition.title}}
              th.border-left.decision-table__result-column.decision-table__add-column Result
                a.decision-table__add-column__icon(ng-click="addNewField()") +
              th Action
            tfoot.table-footer: tr: td(colspan="{{table.fields.length + 3}}")

              .decision-table__default-result.pull-left
                .form-inline: .form-group
                  label Default result:
                  select.form-control(ng-model="table.defaultResult")
                    option(value="approve") approve
                    option(value="decline") decline
                    option(value="manual") manual
              .pull-right
                button.btn.btn-default(ng-click="save()") Save

            tbody(ui-sortable="sortableOptions", ng-model="table.rules")
              tr(ng-repeat="rule in table.rules"): td.decision-table__handler: i.glyphicon.glyphicon-menu-hamburger
                td(ng-repeat="condition in rule.conditions")
                  div.form-control-static(ng-if="!rule.isEditing") {{condition.condition | condition}} {{condition.value.toString()}}
                  field(ng-if="rule.isEditing", type="table.fields[$index].type", condition="condition.condition", value="condition.value")

                td.border-left
                  div.form-control-static(ng-if="!rule.isEditing") {{rule.result}}
                  div(ng-if="rule.isEditing")
                    select.form-control(ng-model="rule.result")
                      option(value="approve") approve
                      option(value="decline") decline
                      option(value="manual") manual

                td.decision-table__description-wrap
                  .decision-table__actions.form-control-static

                    a.btn.btn-default(ng-click="rule.save()", ng-if="rule.isEditing"): i.glyphicon.glyphicon-ok
                    a.btn.btn-default(ng-click="rule.edit()", ng-if="!rule.isEditing"): i.glyphicon.glyphicon-pencil
                    a.btn.btn-default(ng-click="table.deleteRule(rule)"): i.glyphicon.glyphicon-remove

                    .decision-table__description(ng-if="rule.isEditing"): textarea.form-control(ng-model="rule.description")
                    .decision-table__description(ng-if="!rule.isEditing") {{rule.description}}

            tbody.decision-table__add-row: tr: td(colspan="{{table.fields.length + 3}}")
              a(ng-click="addNewRule()") Add new row

    // build:js js/app.min.js

    script(src='bower_components/jquery/dist/jquery.js')
    script(src='bower_components/jquery-ui/jquery-ui.js')

    script(src='bower_components/angular/angular.js')
    script(src='bower_components/angular-ui-router/release/angular-ui-router.js')
    script(src='bower_components/ngstorage/ngStorage.js')

    script(src='bower_components/angular-bootstrap/ui-bootstrap.js')
    script(src='bower_components/angular-bootstrap/ui-bootstrap-tpls.js')

    script(src='bower_components/angular-ui-sortable/sortable.js')

    script(src='js/config.js')
    script(src='js/modules/gandalf.js')
    script(src='js/app.js')

    script(src='js/controllers/add-field-controller.js')
    // endbuild

